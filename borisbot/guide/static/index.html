<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BorisBot Setup</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400&display=swap"
        rel="stylesheet">
</head>

<body>
    <header>
        <div class="logo">
            <span>BorisBot</span> Guide
        </div>
        <div id="connection-status" class="text-xs text-secondary">
            Localhost
        </div>
    </header>

    <main>
        <div id="wizard-container" class="fade-in">
            <div class="wizard-header">
                <h1 id="step-title">Welcome to BorisBot</h1>
                <p id="step-desc">Let's set up your local agent runtime. It only takes a minute.</p>
            </div>

            <div class="stepper">
                <div class="step-dot active" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
                <div class="step-dot" data-step="4"></div>
            </div>

            <!-- Step 1: System -->
            <div id="step-1" class="wizard-step">
                <div class="card">
                    <h2>System Readiness</h2>
                    <p>Checking your environment for compatibility.</p>
                    <div id="system-checks"></div>
                    <div style="margin-top:24px; text-align:right;">
                        <button id="btn-step-1-next" class="btn" disabled>Continue</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Intelligence -->
            <div id="step-2" class="wizard-step hidden">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div>
                            <h2>Choose your Intelligence</h2>
                            <p>Select a local model to power your agents.</p>
                        </div>
                        <div id="ollama-connection-status" style="font-size:13px; font-weight:500;">
                            Checking Ollama...
                        </div>
                    </div>

                    <div id="model-grid" class="model-grid">
                        <!-- injected by js -->
                    </div>

                    <div style="margin-top:40px; border-top:1px solid #f1f3f4; padding-top:32px;">
                        <h2>Or use Cloud APIs</h2>
                        <p>Optional: Add keys for fallback or superior reasoning.</p>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:24px;">
                            <div class="input-group">
                                <label>OpenAI API Key</label>
                                <input type="password" placeholder="sk-..." id="key-openai">
                            </div>
                            <div class="input-group">
                                <label>Anthropic API Key</label>
                                <input type="password" placeholder="sk-ant-..." id="key-anthropic">
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <button class="btn-secondary btn-small" onclick="Wizard.saveCloudKeys()">Save
                                Keys</button>
                        </div>
                    </div>

                    <div style="margin-top:24px; text-align:right; display:flex; justify-content:space-between;">
                        <button onclick="Wizard.prev()" class="btn-text">Back</button>
                        <button id="btn-step-2-next" class="btn" disabled>Continue</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Verification -->
            <div id="step-3" class="wizard-step hidden">
                <div class="card">
                    <h2>Verify Agent Logic</h2>
                    <p>We'll run a "Hello World" task to ensure the planner is working.</p>
                    <div class="terminal" id="verification-log">Waiting to start...</div>
                    <div style="margin-top:24px; text-align:right; display:flex; justify-content:space-between;">
                        <button onclick="Wizard.prev()" class="btn-text">Back</button>
                        <div>
                            <button onclick="Wizard.saveVerifyAgent()" class="btn-secondary"
                                style="margin-right:12px;">Run Verification</button>
                            <button id="btn-step-3-next" class="btn hidden" onclick="Wizard.next()">Continue</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Permissions -->
            <div id="step-4" class="wizard-step hidden">
                <div class="card">
                    <h2>Safety & Permissions</h2>
                    <p>Select a default policy for your agents.</p>

                    <div style="display:grid; gap:16px;">
                        <label class="model-card"
                            style="cursor:pointer; flex-direction:row; align-items:center; gap:16px; border:2px solid #e8f0fe;">
                            <input type="radio" name="policy" value="safe-local" checked style="width:20px; height:20px;">
                            <div>
                                <div class="model-name">Safe Mode</div>
                                <div class="model-meta">Recommended for beginners</div>
                            </div>
                        </label>
                        <label class="model-card"
                            style="cursor:pointer; flex-direction:row; align-items:center; gap:16px;">
                            <input type="radio" name="policy" value="automation" style="width:20px; height:20px;">
                            <div>
                                <div class="model-name">Autonomous Mode</div>
                                <div class="model-meta">Full shell and file access</div>
                            </div>
                        </label>
                    </div>

                    <div style="margin-top:24px; text-align:right; display:flex; justify-content:space-between;">
                        <button onclick="Wizard.prev()" class="btn-text">Back</button>
                        <button onclick="Wizard.applyPolicyAndFinish()" class="btn">Finish Setup</button>
                    </div>
                </div>
            </div>

        </div>

        <div id="dashboard-container" class="hidden fade-in" style="height: 100vh; overflow: hidden;">
            <div style="display: grid; grid-template-columns: 250px 1fr; height: 100%; gap: 0;">
                <!-- Sidebar -->
                <div
                    style="background: #f8f9fa; border-right: 1px solid #e1e4e8; padding: 20px; display: flex; flex-direction: column;">
                    <div class="logo" style="margin-bottom: 32px;">BorisBot</div>

                    <nav style="display: flex; flex-direction: column; gap: 8px;">
                        <button class="btn-text nav-item active" style="text-align: left; justify-content: flex-start;">
                            Inbox
                        </button>
                        <button class="btn-text nav-item" style="text-align: left; justify-content: flex-start;">
                            Automation
                        </button>
                        <button class="btn-text nav-item" style="text-align: left; justify-content: flex-start;">
                            Chat
                        </button>
                        <button class="btn-text nav-item" style="text-align: left; justify-content: flex-start;">
                            Settings
                        </button>
                    </nav>

                    <div style="margin-top: auto;">
                        <div class="text-xs text-secondary">v0.1.0 Beta</div>
                    </div>
                </div>

                <!-- Main ContentArea -->
                <div style="padding: 32px; overflow-y: auto; background: #fff;">

                    <!-- Inbox View -->
                    <div id="view-inbox" style="max-width: 800px; margin: 0 auto;">
                        <h2 style="margin-bottom: 24px;">Task Inbox</h2>

                        <div class="card" style="padding: 0; overflow: hidden; margin-bottom: 24px;">
                            <input type="text" id="inbox-input" placeholder="Add a new task..."
                                style="width: 100%; border: none; padding: 16px 20px; font-size: 16px; outline: none;"
                                onkeydown="if(event.key==='Enter') { Dashboard.addToInbox(this.value); this.value=''; }">
                        </div>

                        <div id="inbox-list" style="display: flex; flex-direction: column; gap: 12px;">
                            <!-- Items will be injected here -->
                            <div class="text-center text-secondary" style="padding: 40px;">No tasks yet. Add one above!
                            </div>
                        </div>
                    </div>

                    <!-- Chat Overlay / Panel (Simple implementation for now) -->
                    <div id="view-automation" class="hidden" style="max-width: 1000px; margin: 0 auto;">
                        <h2 style="margin-bottom: 24px;">Automation</h2>
                        <div class="card" style="margin-bottom: 16px;">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                                <div class="input-group">
                                    <label>Workflow</label>
                                    <select id="auto-workflow" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;background:#fff;"></select>
                                </div>
                                <div class="input-group">
                                    <label>Agent Id</label>
                                    <input id="auto-agent-id" type="text" value="default">
                                </div>
                                <div class="input-group">
                                    <label>Task Id</label>
                                    <input id="auto-task-id" type="text" value="wf_demo">
                                </div>
                                <div class="input-group">
                                    <label>Start URL</label>
                                    <input id="auto-start-url" type="text" value="https://example.com">
                                </div>
                                <div class="input-group">
                                    <label>Model</label>
                                    <input id="auto-model" type="text" value="llama3.2:3b">
                                </div>
                            </div>
                            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;">
                                <button class="btn-secondary btn-small" onclick="Dashboard.runAction('docker_info')">Check Docker</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.runAction('verify')">Verify</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.runAction('record')">Record</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.runAction('replay')">Replay</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.runAction('release_check')">Release Check</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.runAction('release_check_json')">Release JSON</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.loadPermissions()">Permissions</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.loadTraces()">Traces</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.refreshRuntime()">Runtime</button>
                            </div>
                            <div style="margin-top:12px;">
                                <label>Planner Prompt</label>
                                <textarea id="auto-prompt" style="width:100%;min-height:90px;padding:12px;border:1px solid #ddd;border-radius:8px;">Open example.com and get page title.</textarea>
                                <div style="display:flex;gap:8px;margin-top:8px;">
                                    <button class="btn" onclick="Dashboard.runPlanPreview()">Dry-Run Planner</button>
                                    <button class="btn-secondary btn-small" onclick="Dashboard.executeLatestPlan()">Execute Plan</button>
                                </div>
                            </div>
                        </div>
                        <div class="card" style="margin-bottom: 16px;">
                            <h2 style="font-size:22px;">Runtime + Output</h2>
                            <pre id="auto-runtime" class="terminal" style="height:120px;">Loading runtime status...</pre>
                            <a id="auto-browser-link" href="#" target="_blank" class="hidden" style="display:block;margin:8px 0 0;color:#1967d2;"></a>
                            <pre id="auto-output" class="terminal" style="height:220px;">No job yet.</pre>
                        </div>
                        <div class="card" style="margin-bottom: 16px;">
                            <h2 style="font-size:22px;">Permissions</h2>
                            <div id="auto-permissions" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;"></div>
                        </div>
                        <div class="card">
                            <h2 style="font-size:22px;">Traces</h2>
                            <div style="display:flex;gap:8px;margin-bottom:10px;">
                                <select id="auto-trace-select" style="flex:1;padding:10px;border:1px solid #ddd;border-radius:8px;"></select>
                                <button class="btn-secondary btn-small" onclick="Dashboard.loadSelectedTrace()">View</button>
                            </div>
                            <pre id="auto-trace-output" class="terminal" style="height:220px;">No traces loaded.</pre>
                        </div>
                        <div class="card" style="margin-top: 16px;">
                            <h2 style="font-size:22px;">Scheduler + Recovery</h2>
                            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px;">
                                <button class="btn-secondary btn-small" onclick="Dashboard.loadSchedules()">Schedules</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.loadDeadLetters()">Dead Letters</button>
                                <button class="btn-secondary btn-small" onclick="Dashboard.loadArtifacts()">Artifacts</button>
                            </div>
                            <pre id="auto-schedules-output" class="terminal" style="height:140px;">No schedule data loaded.</pre>
                            <pre id="auto-deadletters-output" class="terminal" style="height:140px;">No dead letters loaded.</pre>
                            <div style="display:flex;gap:8px;margin:8px 0;">
                                <input id="auto-deadletter-id" type="text" placeholder="dead letter id (e.g. dlq_00001)" style="flex:1;padding:10px;border:1px solid #ddd;border-radius:8px;">
                                <button class="btn-secondary btn-small" onclick="Dashboard.retryDeadLetter()">Retry Dead Letter</button>
                            </div>
                            <pre id="auto-artifacts-output" class="terminal" style="height:180px;">No artifacts loaded.</pre>
                        </div>
                    </div>

                    <!-- Chat Overlay / Panel (Simple implementation for now) -->
                    <div id="view-chat" class="card hidden"
                        style="height: 600px; display: flex; flex-direction: column;">
                        <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 16px;"></div>
                        <div style="border-top: 1px solid #eee; padding-top: 16px;">
                            <input type="text" placeholder="Message..."
                                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;"
                                onkeydown="if(event.key==='Enter') { Dashboard.sendChat(this.value); this.value=''; }">
                        </div>
                    </div>

                    <!-- Settings View -->
                    <div id="view-settings" class="card hidden" style="max-width: 800px; margin: 0 auto;">
                        <h2 style="margin-bottom: 24px;">Settings</h2>
                        <form onsubmit="event.preventDefault(); Dashboard.saveSettings();">
                            <div class="input-group" style="margin-bottom: 20px;">
                                <label style="display:block; margin-bottom:8px; font-weight:500;">Primary Model</label>
                                <input type="text" id="settings-model" class="input-field" placeholder="llama3.2:3b"
                                    style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                                <p class="text-xs text-secondary" style="margin-top:4px;">Model used for agent planning.
                                </p>
                            </div>

                            <hr style="border:0; border-top:1px solid #eee; margin: 24px 0;">

                            <div class="input-group" style="margin-bottom: 20px;">
                                <label style="display:block; margin-bottom:8px; font-weight:500;">OpenAI API Key</label>
                                <input type="password" id="settings-key-openai" class="input-field" placeholder="sk-..."
                                    style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                            </div>

                            <div class="input-group" style="margin-bottom: 24px;">
                                <label style="display:block; margin-bottom:8px; font-weight:500;">Anthropic API
                                    Key</label>
                                <input type="password" id="settings-key-anthropic" class="input-field"
                                    placeholder="sk-ant-..."
                                    style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                            </div>

                            <div style="text-align: right;">
                                <button type="submit" class="btn">Save Changes</button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </main>
    <script src="/static/js/app.js"></script>
</body>

</html>
